<!DOCTYPE html>
<html>
  <head>
    <base href="/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Safe PWA install prompt (non-blocking) -->
    <script defer src="install_prompt.js"></script>

    <!-- Dev bootstrap for flutter run (no-op in release). 
         flutter.js is added by Flutter toolchain; this call helps when injection fails in debug. -->
    <script defer src="flutter.js"></script>
  </head>
  <body>
    <!-- In release builds Flutter injects main.dart.js and registers flutter_service_worker.js. -->
    <script>
      (function () {
        const isLocal = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
        window.addEventListener('load', async () => {
          // Only attempt manual bootstrap for local debug; release uses the generated loader.
          if (!isLocal || !window._flutter || !window._flutter.loader) return;
          try {
            const engine = await window._flutter.loader.loadEntrypoint({
              serviceWorker: { serviceWorkerVersion: null } // no SW in debug
            });
            const app = await engine.initializeEngine();
            await app.runApp();
          } catch (e) {
            console.error('Flutter boot failed:', e);
            const div = document.createElement('pre');
            div.style.cssText = 'color:#fff;background:#000;padding:16px';
            div.textContent = 'Flutter boot failed: ' + (e && e.message ? e.message : e);
            document.body.appendChild(div);
          }
        });
      })();
    </script>
  </body>
</html>
